#ifndef C23META_U32_DIV
#define C23META_U32_DIV
#include "../../util.h"
#include "../cmp/geq.h"
#include "../cmp/eq.h"

#define U32_DIV(X,Y) _U32_DIV(X,Y)
#define _U32_DIV(X,Y) _U32_DIV_EVAL(DEFER(_U32_DIV_X)(UNWRAP X, Y))
#define _U32_DIV_EVAL(X) _U32_DIV_EVAL1(_U32_DIV_EVAL1(_U32_DIV_EVAL1(_U32_DIV_EVAL1(X))))
#define _U32_DIV_EVAL1(X) _U32_DIV_EVAL2(_U32_DIV_EVAL2(_U32_DIV_EVAL2(_U32_DIV_EVAL2(X))))
#define _U32_DIV_EVAL2(X) _U32_DIV_EVAL3(_U32_DIV_EVAL3(_U32_DIV_EVAL3(_U32_DIV_EVAL3(X))))
#define _U32_DIV_EVAL3(X) _U32_DIV_EVAL4(_U32_DIV_EVAL4(_U32_DIV_EVAL4(_U32_DIV_EVAL4(X))))
#define _U32_DIV_EVAL4(X) X

#define _U32_DIV_X(A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,\
                      A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,\
                      A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31,B)\
                        BITDIV_PREAMBLE(U32_EQ(B,U32_0),B,\
                          A31,A30,A29,A28,A27,A26,A25,A24,A23,A22,A21,\
                          A20,A19,A18,A17,A16,A15,A14,A13,A12,A11,A10,\
                          A9,A8,A7,A6,A5,A4,A3,A2,A1,A0)\


#define BITDIV_PREAMBLE(EQ0,D,...) (DEFER(CAT(BITDIV_P,EQ0))(U32_0, D __VA_OPT__(,) __VA_ARGS__))
#define BITDIV_P0(...) BITDIV(__VA_ARGS__)
#define BITDIV_P1(...) U32_0 _Pragma("GCC error \"Division by Zero\"")

#define BITDIV(R,D,A,...) BITDIVX(U32_LSHIFTREP1(A,R), D __VA_OPT__(,) __VA_ARGS__)
#define BITDIVX(R,D,...) BITDIVY(U32_GEQ(R,D), R, D __VA_OPT__(,) __VA_ARGS__)
#define BITDIVY(G,R,...) DEFER(CAT(BITDIVZ_,G))(R,__VA_ARGS__) // MESSAGE(R)
#define BITDIVZ_0(R,D,...) __VA_OPT__(OBSTRUCT(BITDIV_I)()(R,D,__VA_ARGS__),) 0
#define BITDIVZ_1(R,D,...) __VA_OPT__(OBSTRUCT(BITDIV_I)()(U32_SUB(R,D), D, __VA_ARGS__),) 1
#define BITDIV_I() BITDIV

#define U32_LSHIFTREP1(R,X)\
  U32_LSHIFTREP1_EVAL(DEFER(_U32_LSHIFTREP1)(R, UNWRAP X))
#define _U32_LSHIFTREP1(R,A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31)\
  (R,A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30)
#define U32_LSHIFTREP1_EVAL(X) X


#endif