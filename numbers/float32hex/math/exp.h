#ifndef C23META_FP32H_EXP
#define C23META_FP32H_EXP

#define FP32H_EXP(X) _FP32H_EXP_C(X)
#define _FP32H_EXP_C(X) CAT(_FP32H_EXP_CHECK_, FP32H_CLASSIFY(X))(X)

#define _FP32H_EXP_CHECK_nan(X) FP32H_NAN
#define _FP32H_EXP_CHECK_infinity(X) CAT(_FP32H_EXP_CHECK_infinity_, FP32H_SIGN_BIT(X)) 
#define _FP32H_EXP_CHECK_zero(X) FP32H_1
#define _FP32H_EXP_CHECK_other(X) FP32H_EXP_UNCHECKED(X)

#define _FP32H_EXP_CHECK_infinity_0 FP32H_INF
#define _FP32H_EXP_CHECK_infinity_1 FP32H_0

#define FP32H_EXP_UNCHECKED(X)\
  FP32H_MUL_UNCHECKED(\
    FP32H_POW_I_UNCHECKED(FP32H_EULER, FP32H_TO_U32(X)),\
    _FP32H_EXP(FP32H_FRACT_UNCHECKED(X))\
  )

#define _FP32H_EXP(X) _FP32H_EXP_C2(X)
#define _FP32H_EXP_C2(X) CAT(_FP32H_EXP_ISZ, FP32H_IS_ZERO(X))(X)
#define _FP32H_EXP_ISZ1(X) FP32H_1
#define _FP32H_EXP_ISZ0(X) _FP32H_EXP_C3(X,FP32H_MUL(X,X))
#define _FP32H_EXP_C3(X,X2) _FP32H_EXP_X(X,X2)
#define _FP32H_EXP_X(X,X2) _FP32H_EXP_XC(X,X2,FP32H_MUL(X,X2),FP32H_MUL(X2,X2))
#define _FP32H_EXP_XC(X,X2,X3,X4) _FP32H_EXP_Y(X,X2,X3,X4)
#define _FP32H_EXP_Y(X,X2,X3,X4) _FP32H_EXP_Z(X,X2,X3,X4,FP32H_MUL(X4,X),FP32H_MUL(X4,X2),FP32H_MUL(X4,X3))

#define _FP32H_EXP_Z(X,X2,X3,X4,X5,X6,X7)\
  FP32H_ADD(\
    FP32H_1,\
    FP32H_ADD(\
      X,\
      FP32H_ADD(\
        FP32H_DIV2(X2),\
        FP32H_ADD(\
          FP32H_MUL(X3, FP32H_1L6),\
          FP32H_ADD(\
            FP32H_MUL(X4, FP32H_1L24),\
            FP32H_ADD(\
              FP32H_MUL(X5, FP32H_1L120),\
              FP32H_ADD(\
                 FP32H_MUL(X6, FP32H_1L720),\
                 FP32H_MUL(X7, FP32H_1L5040))))))))


#define FP32H_EULER  (4,5,8,f,d,2,0,4)
#define FP32H_1L720  (1,6,b,0,6,b,a,3)
#define FP32H_1L5040 (1,0,d,0,0,5,9,3)
#endif