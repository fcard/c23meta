#ifndef C23META_U128H_POW
#define C23META_U128H_POW

#define U128H_POW(X,Y) _U128H_POW(X,Y)
#define _U128H_POW(X,Y) _U128H_POW_EVAL(_U128H_POW_PREAMBLE(U128H_EQ(Y, U128H_0), X, Y))
#define _U128H_POW_EVAL(X) _U128H_POW_EVAL1(_U128H_POW_EVAL1(_U128H_POW_EVAL1(_U128H_POW_EVAL1(X))))
#define _U128H_POW_EVAL1(X) _U128H_POW_EVAL2(_U128H_POW_EVAL2(_U128H_POW_EVAL2(_U128H_POW_EVAL2(X))))
#define _U128H_POW_EVAL2(X) _U128H_POW_EVAL3(_U128H_POW_EVAL3(_U128H_POW_EVAL3(_U128H_POW_EVAL3(X))))
#define _U128H_POW_EVAL3(X) _U128H_POW_EVAL4(_U128H_POW_EVAL4(_U128H_POW_EVAL4(_U128H_POW_EVAL4(X))))
#define _U128H_POW_EVAL4(X) X

#define _U128H_POW_PREAMBLE(G,X,N) DEFER(CAT(_U128H_POW_P,G))(X,N)
#define _U128H_POW_P0(X,N) _U128H_POW_X(X,U128H_1,N)
#define _U128H_POW_P1(X,N) U128H_1

#define _U128H_POW_X(X,Y,N) _U128H_POW_Y(U128H_GT(N,U128H_1),X,Y,N)
#define _U128H_POW_Y(G,X,Y,N) DEFER(CAT(_U128H_POW_Z,G))(X,Y,N)
#define _U128H_POW_Z0(X,Y,N) U128H_MUL(X,Y)
#define _U128H_POW_Z1(X,Y,N) _U128H_POW_V(U128H_IS_ODD(N),X,Y,N)
#define _U128H_POW_V(G,X,Y,N) DEFER(CAT(_U128H_POW_W,G))(X,Y,N)
#define _U128H_POW_W0(X,Y,N) OBSTRUCT(_U128H_POW_I)()(U128H_MUL(X,X),Y,U128H_RSH1(N))
#define _U128H_POW_W1(X,Y,N) OBSTRUCT(_U128H_POW_I)()(U128H_MUL(X,X),U128H_MUL(X,Y),U128H_RSH1(U128H_SUB(N,U128H_1)))
#define _U128H_POW_I() _U128H_POW_X

#endif